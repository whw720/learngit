<!-- 科室事务管理表格 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" type="text/css" href="/lib/extjs/resources/css/ext-all-neptune.css"/>
<link rel="stylesheet" type="text/css" href="../../css/common-png.css"/>
<link rel="stylesheet" type="text/css" href="../sys/desktop/css/desktop.css"/>
<link rel="stylesheet" type="text/css" href="./css/dtm.css"/>
<script type="text/javascript" src="/lib/extjs/ext-all.js"></script>
<script type="text/javascript" src="/lib/extjs/locale/ext-lang-zh_CN.js"></script>
<script type="text/javascript" src="/lib/extjs/ext-theme-neptune.js"></script>
<script type="text/javascript" src="GridCellCommon.js"></script>
<script type="text/javascript">
window.onresize = function () {
    var activeTabId = parent.Ext.getCmp('dtm-report-panel').getActiveTab().id;
    var schedulingGrid = Ext.getCmp('schedulingGrid' + activeTabId);
    schedulingGrid.setWidth(window.innerWidth);
    schedulingGrid.setHeight(window.innerHeight);
};
var request = {
    QueryString: function (val) {
        var uri = window.location.search;
        var re = new RegExp("" + val + "=([^&?]*)", "ig");
        return ((uri.match(re)) ? (uri.match(re)[0].substr(val.length + 1)) : null);
    },
    showErr: function (err, info) {
        parent.Ext.Msg.show({
            title: '错误',
            msg: '长期医嘱数据' + info + '失败：' + err,
            buttons: Ext.Msg.OK,
            icon: Ext.Msg.ERROR
        });
    },
    showLanErr: function (info) {
        parent.Ext.MessageBox.alert('提示', '数据' + info + '失败,请求超时或网络故障!');
    }
};
window.onload = function () {
    var userId = request.QueryString('userId');
    var owner = request.QueryString('owner');
    owner = owner && owner == 'D' ? 'D' : 'N';
    Ext.onReady(
            function () {
                var width = window.innerWidth;
                var height = window.innerHeight;
                var gridCellComon = Ext.create('com.dfsoft.lancet.dtm.GridCellCommon');
                Ext.define('userModel', {
                    extend: 'Ext.data.Model',
                    fields: [
                        {
                            name: 'id',
                            type: 'string'
                        },
                        {
                            name: 'name',
                            type: 'string'
                        },
                        {
                            name: 'schedulType'
                        },
                        {
                            name: 'schedulingInfoArr'
                        },
                        {
                            name: 'deptName',
                            type: 'string'
                        },
                        {
                            name: 'workTime'
                        },
                        {
                            name: 'owner',
                            type: 'string'
                        }
                    ]
                });
                Ext.define('schedulingTypeModel', {
                    extend: 'Ext.data.Model',
                    fields: [
                        {
                            name: 'ID',
                            type: 'string'
                        },
                        {
                            name: 'NAME',
                            type: 'string'
                        },
                        {
                            name: 'TIME_1ST_BEGIN',
                            type: 'string'
                        },
                        {
                            name: 'TIME_1ST_END',
                            type: 'string'
                        },
                        {
                            name: 'TIME_2ND_BEGIN',
                            type: 'string'
                        },
                        {
                            name: 'TIME_2ND_END',
                            type: 'string'
                        }
                    ]
                });
                Ext.define('deptModel', {
                    extend: 'Ext.data.Model',
                    fields: [
                        {
                            name: 'deptId',
                            type: 'string'
                        },
                        {
                            name: 'deptName',
                            type: 'string'
                        }
                    ]
                });

                var userStore = null;
                var schedulingTypeStore = null;
                var deptStore = null;
                var optionStr = '';
                var currentDateArr = getMonDate(new Date());
                var weekDateStr = '时间段：' + currentDateArr[0] + ' 至 ' + currentDateArr[6];
                var activeTabId = parent.Ext.getCmp('dtm-report-panel').getActiveTab().id;
                userStore = Ext.create('Ext.data.Store', {
                    model: 'userModel',
                    autoLoad: true,
                    proxy: {
                        type: 'ajax',
                        url: parent.webRoot + '/dtm/getUsersByTypes/' + owner + '/' + Ext.encode(currentDateArr) + '/all',
                        method: 'GET',
                        reader: {
                            type: 'json',
                            root: 'data'
                        }
                    },
                    listeners: {
                        load: function (_this, records, successful, eOpts) {
                            schedulingValue(_this);
                        }
                    }
                });
                deptStore = Ext.create('Ext.data.Store', {
                    model: 'deptModel',
                    autoLoad: true,
                    proxy: {
                        type: 'ajax',
                        url: parent.webRoot + '/dtm/getDeptList/' + owner,
                        method: 'GET',
                        extraParams: {
                            userId: userId
                        },
                        reader: {
                            type: 'json',
                            root: 'data'
                        }
                    },
                    listeners: {
                        load: function (_this, records, successful, eOpts) {
                            Ext.getCmp('dtmDept' + activeTabId).setValue('all');
                        }
                    }
                });
                Ext.create('Ext.grid.Panel', {
                    id: 'schedulingGrid' + activeTabId,
                    columnLines: true,
                    renderTo: Ext.getBody(),
                    store: userStore,
                    width: width,
                    height: height,
                    autoScroll: true,
                    currentDateArr: currentDateArr,
                    owner: owner,
                    columns: [
                        {
                            text: '姓名',
                            dataIndex: 'name',
                            sortable: false,
                            menuDisabled: true
                        },
                        {
                            text: '所属科室',
                            dataIndex: 'deptName',
                            sortable: false,
                            menuDisabled: true
                        },
                        {
                            text: '周一',
                            dataIndex: '',
                            width: 116,
                            xtype: 'templatecolumn',
                            tpl: gridCellComon.getTemplate('{id}_mon', '{schedulType}', '{schedulingInfoArr}', activeTabId),
                            sortable: false,
                            menuDisabled: true
                        },
                        {
                            text: '周二',
                            width: 116,
                            dataIndex: '',
                            xtype: 'templatecolumn',
                            tpl: gridCellComon.getTemplate('{id}_tue', '{schedulType}', '{schedulingInfoArr}', activeTabId),
                            sortable: false,
                            menuDisabled: true
                        },
                        {
                            text: '周三',
                            width: 116,
                            dataIndex: '',
                            xtype: 'templatecolumn',
                            tpl: gridCellComon.getTemplate('{id}_wed', '{schedulType}', '{schedulingInfoArr}', activeTabId),
                            sortable: false,
                            menuDisabled: true
                        },
                        {
                            text: '周四',
                            width: 116,
                            dataIndex: '',
                            xtype: 'templatecolumn',
                            tpl: gridCellComon.getTemplate('{id}_thu', '{schedulType}', '{schedulingInfoArr}', activeTabId),
                            sortable: false,
                            menuDisabled: true
                        },
                        {
                            text: '周五',
                            width: 116,
                            dataIndex: '',
                            xtype: 'templatecolumn',
                            tpl: gridCellComon.getTemplate('{id}_fri', '{schedulType}', '{schedulingInfoArr}', activeTabId),
                            sortable: false,
                            menuDisabled: true
                        },
                        {
                            text: '周六',
                            width: 116,
                            dataIndex: '',
                            xtype: 'templatecolumn',
                            tpl: gridCellComon.getTemplate('{id}_sta', '{schedulType}', '{schedulingInfoArr}', activeTabId),
                            sortable: false,
                            menuDisabled: true
                        },
                        {
                            text: '周日',
                            width: 116,
                            dataIndex: '',
                            xtype: 'templatecolumn',
                            tpl: gridCellComon.getTemplate('{id}_sun', '{schedulType}', '{schedulingInfoArr}', activeTabId),
                            sortable: false,
                            menuDisabled: true
                        },
                        {
                            text: '本周工时',
                            xtype: 'templatecolumn',
                            tpl: '<input id="{id}weekWorkTime" type="text" style="height:90px;width:80px;" readOnly="true"/>',
                            sortable: false,
                            menuDisabled: true
                        },
                        {
                            text: '本月工时',
                            xtype: 'templatecolumn',
                            tpl: '<input id="{id}workTime" type="text" style="height:90px;width:80px;" readOnly="true"/>',
                            sortable: false,
                            menuDisabled: true
                        }
                    ],
                    dockedItems: [
                        {
                            xtype: 'toolbar',
                            dock: 'top',
                            html: '<iframe src="about:blank"  style="display:none;" width="200" height="100" id="schel_excel_iframe"></iframe>',
                            items: [
                                {
                                    xtype: 'button',
                                    //padding: '0 1 0 1',
                                    id: 'dtmpre' + activeTabId,
                                    tooltip: '上一周',
                                    tooltipType: 'title',
                                    text: '上一周',
                                    handler: function () {
                                        var grid = this.up().up();
                                        var activeTabId = parent.Ext.getCmp('dtm-report-panel').getActiveTab().id;
                                        var currentDateArr = grid.currentDateArr;
                                        var date = new Date(currentDateArr[0]);
                                        date.setDate(date.getDate() - 1);
                                        var preDateArr = getMonDate(date);
                                        grid.currentDateArr = preDateArr;
                                        var weekDateStr = '时间段：' + preDateArr[0] + ' 至 ' + preDateArr[6];
                                        var owner = grid.owner;
                                        grid.getStore().setProxy({
                                            type: 'ajax',
                                            url: parent.webRoot + '/dtm/getUsersByTypes/' + owner + '/' + Ext.encode(preDateArr) + '/' + Ext.getCmp('dtmDept' + activeTabId).getValue(),
                                            reader: {
                                                type: 'json',
                                                root: 'data'
                                            }
                                        });
                                        grid.getStore().load();
                                        schedulingValue(grid.getStore());
                                        Ext.getCmp('dtmWeekDateStr' + activeTabId).setText(weekDateStr);
                                    }
                                },
                                {
                                    xtype: 'tbtext',
                                    id: 'dtmWeekDateStr' + activeTabId,
                                    text: weekDateStr
                                },
                                {
                                    xtype: 'button',
                                    //padding: '0 1 0 1',
                                    id: 'dtmnext' + activeTabId,
                                    //disabled: true,
                                    tooltip: '下一周',
                                    tooltipType: 'title',
                                    text: '下一周',
                                    handler: function () {
                                        var grid = this.up().up();
                                        var activeTabId = parent.Ext.getCmp('dtm-report-panel').getActiveTab().id;
                                        var currentDateArr = grid.currentDateArr;
                                        var date = new Date(currentDateArr[6]);
                                        date.setDate(date.getDate() + 1);
                                        var nextDateArr = getMonDate(date);
                                        grid.currentDateArr = nextDateArr;
                                        var weekDateStr = '时间段：' + nextDateArr[0] + ' 至 ' + nextDateArr[6];
                                        var owner = grid.owner;
                                        grid.getStore().setProxy({
                                            type: 'ajax',
                                            url: parent.webRoot + '/dtm/getUsersByTypes/' + owner + '/' + Ext.encode(nextDateArr) + '/' + Ext.getCmp('dtmDept' + activeTabId).getValue(),
                                            reader: {
                                                type: 'json',
                                                root: 'data'
                                            }
                                        });
                                        grid.getStore().load();
                                        schedulingValue(grid.getStore());

                                        Ext.getCmp('dtmWeekDateStr' + activeTabId).setText(weekDateStr);
                                        //判断是否是今天所在的周，如果是保存、删除、复制上周 按钮可用,时间段字符串改变,下一周按钮可用；如果不是保存、删除、复制上周 按钮不可用,时间段字符串改变,下一周按钮可用
                                        // var nowDateStr = Ext.util.Format.date(new Date,'Y-m-d');
                                        // var flag = false;
                                        // for(var i=0;i<grid.currentDateArr.length;i++){
                                        // 	if(grid.currentDateArr[i] == nowDateStr){
                                        // 		flag = true;
                                        // 	}
                                        // }
                                        // if(flag){
                                        // 	Ext.getCmp('dtmsave'+activeTabId).setDisabled(false);
                                        //  Ext.getCmp('dtmdelete'+activeTabId).setDisabled(false);
                                        //  Ext.getCmp('dtmcopy'+activeTabId).setDisabled(false);
                                        //  Ext.getCmp('dtmWeekDateStr'+activeTabId).setText(weekDateStr);
                                        //  Ext.getCmp('dtmnext'+activeTabId).setDisabled(true);
                                        // }else{
                                        // 	Ext.getCmp('dtmsave'+activeTabId).setDisabled(true);
                                        //  Ext.getCmp('dtmdelete'+activeTabId).setDisabled(true);
                                        //  Ext.getCmp('dtmcopy'+activeTabId).setDisabled(true);
                                        //  Ext.getCmp('dtmWeekDateStr'+activeTabId).setText(weekDateStr);
                                        //  Ext.getCmp('dtmnext'+activeTabId).setDisabled(false);
                                        // }
                                    }
                                },
                                {
                                    xtype: 'combo',
                                    fieldLabel: '所属科室',
                                    id: 'dtmDept' + activeTabId,
                                    labelWidth: 60,
                                    editable: false,
                                    valueField: 'deptId',
                                    displayField: 'deptName',
                                    store: deptStore,
                                    listeners: {
                                        select: function (combo, records, eOpts) {
                                            var grid = this.up().up();
                                            var store = grid.getStore();
                                            store.setProxy({
                                                type: 'ajax',
                                                url: parent.webRoot + '/dtm/getUsersByTypes/' + owner + '/' + Ext.encode(grid.currentDateArr) + '/' + records[0].get('deptId'),
                                                method: 'GET',
                                                reader: {
                                                    type: 'json',
                                                    root: 'data'
                                                }
                                            });
                                            store.load();
                                            schedulingValue(store);
                                        }
                                    }
                                },

                                '->',
                                {
                                    xtype: 'button',
                                    id: 'dtmsave' + activeTabId,
                                    //padding: '0 1 0 1',
                                    tooltip: '保存',
                                    tooltipType: 'title',
                                    iconCls: 'save',
                                    handler: function () {
                                        var grid = this.up().up();
                                        var arr = getSubmitData(grid.getStore(), grid.currentDateArr);
                                        if (arr != null) {
                                            Ext.Ajax.request({
                                                url: parent.webRoot + '/dtm/saveSchedulingArr',
                                                method: 'POST',
                                                params: {scheduling: Ext.encode(arr)},
                                                success: function (response) {
                                                    //Ext.MessageBox.alert('提示', '保存成功!');
                                                    var activeTabId = parent.Ext.getCmp('dtm-report-panel').getActiveTab().id;
                                                    var schedulingGrid = Ext.getCmp('schedulingGrid' + activeTabId);
                                                    var gridStore = schedulingGrid.getStore();
                                                    gridStore.load();
                                                    //schedulingValue(grid.getStore());
                                                }
                                            });
                                        } else {
                                            return;
                                        }
                                    }
                                },
                                {
                                    xtype: 'button',
                                    //padding: '0 1 0 1',
                                    id: 'dtmdelete' + activeTabId,
                                    tooltip: '删除',
                                    tooltipType: 'title',
                                    iconCls: 'delete',
                                    handler: function () {
                                        var grid = this.up().up();
                                        var records = grid.getSelectionModel().getSelection();
                                        if (records.length <= 0) {
                                            Ext.MessageBox.alert('提示', '请选中一条排班日历信息进行删除');
                                        } else {
                                            Ext.MessageBox.confirm('提示', '确定删除选中的排班信息吗?', function (_btn) {
                                                if (_btn == 'yes') {
                                                    //删除选中的数据 deleteSchedulByUser
                                                    Ext.each(records, function (records) {
                                                        var userId = records.data.id;
                                                        Ext.Ajax.request({
                                                            url: parent.webRoot + '/dtm/deleteSchedulByUser',
                                                            method: 'POST',
                                                            params: {
                                                                userId: records.data.id,
                                                                startDate: grid.currentDateArr[0],
                                                                endDate: grid.currentDateArr[6]
                                                            },
                                                            success: function (response) {
                                                                // Ext.MessageBox.alert('提示', '删除成功。');
                                                                grid.getStore().load();
                                                            }
                                                        });
                                                    });
                                                } else {
                                                    return false;
                                                }
                                            });
                                        }
                                    }
                                },
                                {
                                    xtype: 'button',
                                    //padding: '0 1 0 1',
                                    id: 'dtmcopy' + activeTabId,
                                    tooltip: '复制上周',
                                    tooltipType: 'title',
                                    iconCls: 'batch-add',
                                    handler: function () {
                                        var grid = this.up().up();
                                        Ext.MessageBox.confirm('提示', '复制上周排班信息将覆盖本周现有的排班信息，确定复制上周排班信息到本周吗?', function (_btn) {
                                            if (_btn == 'yes') {
                                                var store = grid.getStore();
                                                var owner = grid.owner;
                                                var currentDateArr = grid.currentDateArr;
                                                var date = new Date(currentDateArr[0]);
                                                date.setDate(date.getDate() - 1);
                                                var preDateArr = getMonDate(date);
                                                //重组store 将上周的排班信息查询出来,然后将排班信息复制到当前周中
                                                Ext.Ajax.request({
                                                    url: parent.webRoot + '/dtm/getUsersByTypes/' + owner + '/' + Ext.encode(preDateArr) + '/all',
                                                    method: 'GET',
                                                    success: function (response) {
                                                        var activeTabId = parent.Ext.getCmp('dtm-report-panel').getActiveTab().id;
                                                        var schedulingGrid = Ext.getCmp('schedulingGrid' + activeTabId);
                                                        var gridStore = schedulingGrid.getStore();
                                                        //将排班信息复制到当前周中
                                                        var data = Ext.decode(response.responseText).data;
                                                        var currentDateArr = schedulingGrid.currentDateArr;
                                                        preSchedulingValue(gridStore, data, currentDateArr, date);
                                                    }
                                                });
                                            } else {
                                                return false;
                                            }
                                        });
                                    }
                                },
                                {
                                    xtype: 'button',
                                    id: 'dtmprint' + activeTabId,
                                    tooltip: '打印',
                                    tooltipType: 'title',
                                    iconCls: 'print',
                                    handler: function () {
                                        var me = this;
                                        var gridcontrol = Ext.getCmp('schedulingGrid' + activeTabId);

                                        var cm = gridcontrol.getView().getGridColumns();
                                        var colCount = cm.length;
                                        var temp_obj = new Array();
                                        var colAllCount = 0;
                                        for (var i = 0; i < colCount; i++) {
                                            if (cm[i].columns != null && cm[i].columns.length > 0) {
                                                colAllCount += cm[i].columns.length;
                                                temp_obj = temp_obj.concat(cm[i].columns);
                                            } else {
                                                colAllCount++;
                                                temp_obj.push(cm[i]);
                                            }
                                        }
                                        var tableStr = '<table  style="border-top:1px black solid;border-left:1px black solid; width:100%;" cellpadding=0 cellspacing=0>';

                                        tableStr += '<tr><td colspan="' + colCount + '" style="border-right:1px black solid;border-bottom:1px black solid;font-size:24px;text-align: center;font-weight:bold;">排班日历</td></tr>';
                                        tableStr += '<tr><td colspan="' + colCount + '" style="border-right:1px black solid;border-bottom:1px black solid;font-size:11px;text-align: left;">' + Ext.getCmp('dtmWeekDateStr' + activeTabId).text + '</td></tr>';
                                        for (var i = 0; i < colCount; i++) {
                                            if (i == 0) {
                                                tableStr = tableStr + '<tr><td style="border-right:1px black solid;border-bottom:1px black solid;text-align: center;width:100px;">' + cm[i].text + '</td>';
                                            } else if (i == 1) {
                                                tableStr = tableStr + '<td style="border-right:1px black solid;border-bottom:1px black solid;text-align: center;width:90px;">' + cm[i].text + '</td>';
                                            } else if (i >= 2 && i <= 8) {
                                                tableStr = tableStr + '<td style="border-right:1px black solid;border-bottom:1px black solid;text-align: center;width:80px;">' + cm[i].text + '</td>';
                                            } else {
                                                tableStr = tableStr + '<td style="border-right:1px black solid;border-bottom:1px black solid;text-align: center;">' + cm[i].text + '</td>';
                                            }

                                        }
                                        tableStr = tableStr + '</tr>';
                                        var arrayTr = document.getElementById('schedulingGrid' + activeTabId + '-body').firstChild.firstChild.lastChild.childNodes;//getElementsByTagName('tr');
                                        for (var i = 0; i < arrayTr.length; i++) {
                                            var arryTd = arrayTr[i].childNodes;//getElementsByTagName("td");
                                            for (var j = 0; j < arryTd.length; j++) {
                                                var td = arryTd[j];
                                                if (j == 0) {
                                                    tableStr = tableStr + '<tr><td style="border-right:1px black solid;border-bottom:1px black solid;text-align: left;">' + td.innerText + '</td>';
                                                } else if (j == 1) {
                                                    tableStr = tableStr + '<td style="border-right:1px black solid;border-bottom:1px black solid;text-align: left;">' + td.innerText + '</td>';
                                                    /*if(td.style.display!='none'){
                                                     tableStr = tableStr + '<td rowspan="'+td.rowSpan+'" style="border-right:1px black solid;border-bottom:1px black solid;">' + td.innerText + '</td>';
                                                     }*/
                                                } else if (j >= 2 && j <= 8) {
                                                    var schedTR = td.firstChild.firstChild.lastChild.getElementsByTagName('tr');
                                                    tableStr += '<td><table style="width:100%;" cellpadding=0 cellspacing=0>'
                                                    for (var m = 0; m < schedTR.length; m++) {
                                                        var schedTds = schedTR[m].getElementsByTagName("td");
                                                        if (m == 0) {
                                                            var select = schedTds[0].firstChild
                                                            var text = select.options[select.selectedIndex].text;
                                                            if (text == '请选择..') {
                                                                text = '&nbsp;';
                                                            }
                                                            tableStr += '<tr><td style="border-right:1px black solid;border-bottom:1px black solid;text-align: center;">' + text + '</td>'
                                                        } else {
                                                            var tdStr = schedTds[0].firstChild.value + ':' + schedTds[0].firstChild.nextSibling.value + '~' +
                                                                    schedTds[0].lastChild.previousSibling.value + ':' + schedTds[0].lastChild.value;
                                                            if (schedTds[0].firstChild.value == '' || schedTds[0].lastChild.value == '') {
                                                                tdStr = '&nbsp;';
                                                            }
                                                            tableStr += '<tr><td style="border-right:1px black solid;border-bottom:1px black solid;text-align: center;">' + tdStr + '</td>'
                                                            /*for(var n=0;n<schedTds.length;n++){
                                                             var schedTd=schedTds[n];
                                                             if(n==0){
                                                             tableStr+='<tr><td></td>'
                                                             }
                                                             }*/
                                                        }

                                                        tableStr += '</tr>';
                                                    }
                                                    tableStr += '</table></td>';
                                                } else {
                                                    var inpuStr = td.firstChild.firstChild.value;
                                                    tableStr = tableStr + '<td style="border-right:1px black solid;border-bottom:1px black solid;text-align: left;">' + inpuStr + '</td>';
                                                }
                                            }
                                            tableStr = tableStr + '</tr>';
                                        }

                                        tableStr = tableStr + '</table>';
                                        window.parent.printHtml(tableStr);
                                    }
                                },
                                {
                                    xtype: 'button',
                                    id: 'dtmExport' + activeTabId,
                                    tooltip: '导出',
                                    tooltipType: 'title',
                                    iconCls: 'dtm-schedul-excel',
                                    handler: function () {
                                        var me = this;
                                        var gridcontrol = Ext.getCmp('schedulingGrid' + activeTabId);

                                        var cm = gridcontrol.getView().getGridColumns();
                                        var colCount = cm.length;
                                        var temp_obj = new Array();
                                        var colAllCount = 0;
                                        for (var i = 0; i < colCount; i++) {
                                            if (cm[i].columns != null && cm[i].columns.length > 0) {
                                                colAllCount += cm[i].columns.length;
                                                temp_obj = temp_obj.concat(cm[i].columns);
                                            } else {
                                                colAllCount++;
                                                temp_obj.push(cm[i]);
                                            }
                                        }

                                        var str = '';
                                        str += 'mergeCell,0,0,0,' + (colCount - 1) + ';cellValue,0,0,'+(owner=='D'?'医生':'护士')+'排班日历;cellAlign,0,0,center;cellFont,0,0,20,1;';
                                        str += 'mergeCell,1,1,0,' + (colCount - 1) + ';cellValue,1,0,' + Ext.getCmp('dtmWeekDateStr' + activeTabId).text + ';cellAlign,1,0,left;';
                                        for (var i = 0; i < colCount; i++) {
                                            str += 'cellValue,2,' + i + ',' + cm[i].text + ';cellFont,2,' + i + ',,1;cellAlign,2,' + i + ',center;';
                                        }

                                        var arrayTr = document.getElementById('schedulingGrid' + activeTabId + '-body').firstChild.firstChild.lastChild.childNodes;//getElementsByTagName('tr');
                                        for (var i = 0; i < arrayTr.length; i++) {
                                            var arryTd = arrayTr[i].childNodes;//getElementsByTagName("td");
                                            for (var j = 0; j < arryTd.length; j++) {
                                                var td = arryTd[j];
                                                if (j <= 1) {
                                                    str += 'mergeCell,' + (i * 3 + 3) + ',' + (i * 3 + 5) + ',' + j + ',' + j + ';cellValue,' + (i * 3 + 3) + ',' + j + ',' + td.innerText + ';cellAlign,' + (i * 3 + 3) + ',' + j + ',left;';
                                                } else if (j >= 2 && j <= 8) {
                                                    var schedTR = td.firstChild.firstChild.lastChild.getElementsByTagName('tr');
                                                    for (var m = 0; m < schedTR.length; m++) {
                                                        var schedTds = schedTR[m].getElementsByTagName("td");
                                                        if (m == 0) {
                                                            var select = schedTds[0].firstChild
                                                            var text = select.options[select.selectedIndex].text;
                                                            if (text == '请选择..') {
                                                                continue;
                                                            }
                                                            str += 'cellValue,' + (i * 3 + 3) + ',' + j + ',' + text + ';cellAlign,' + (i * 3 + 3) + ',' + j + ',center;';
                                                        } else {
                                                            var tdStr = schedTds[0].firstChild.value + ':' + schedTds[0].firstChild.nextSibling.value + '~' +
                                                                    schedTds[0].lastChild.previousSibling.value + ':' + schedTds[0].lastChild.value;
                                                            if (schedTds[0].firstChild.value == '' || schedTds[0].lastChild.value == '') {
                                                                continue;
                                                            }
                                                            str += 'cellValue,' + (i * 3 + 3 + m) + ',' + j + ',' + tdStr + ';cellAlign,' + (i * 3 + 3 + m) + ',' + j + ',center;';
                                                        }
                                                    }
                                                } else {

                                                    var inpuStr = td.firstChild.firstChild.value;
                                                    str += 'mergeCell,' + (i * 3 + 3) + ',' + (i * 3 + 5) + ',' + j + ',' + j + ';cellValue,' + (i * 3 + 3) + ',' + j + ',' + inpuStr + ';cellAlign,' + (i * 3 + 3) + ',' + j + ',left;';
                                                }
                                            }
                                        }

                                        str = 'createGrid,' + (arrayTr.length * 3 + 3) + ',' + colCount + ';' + str;
                                        var url = parent.hummerurl + '/application/controller/run/ExportExcel.action';
                                        var htmlStr = '<form action="' + url + '" method="post" target="_self" id="schel_postData_form">' +
                                                '<input id="content" name="content" type="hidden" value="' + str + '"/>' +
                                                '<input id="name" name="name" type="hidden" value="'+(owner=='D'?'医生':'护士')+'排班日历"/>' +
                                                '</form>';
                                        var iframe1 = document.getElementById('schel_excel_iframe');
                                        iframe1.contentWindow.document.open();
                                        iframe1.contentWindow.document.write(htmlStr);
                                        iframe1.contentWindow.document.close();
                                        iframe1.contentWindow.document.getElementById('schel_postData_form').submit();
                                    }
                                }
                            ]
                        }
                    ]
                });
            }
    );
};
//获取当前星期的周一到周日的日期,返回Date数组
function getMonDate(d) {
    var dateArr = [];
    var day = d.getDay(),
            date = d.getDate();
    if (day == 0)
        d.setDate(date - 6);
    else
        d.setDate(date - day + 1);

    for (var i = 0; i < 7; i++) {
        var temp = Ext.util.Format.date(d, 'Y-m-d');
        dateArr.push(temp);
        d.setDate(d.getDate() + 1);
    }
    return dateArr;
}
//设置时间输入框是否可用
function timeInputDisabled(dateObj1, dateObj2, optionValue) {
    if (optionValue != null && optionValue != 'null' && optionValue.length > 0) {
        dateObj1.disabled = false;
        dateObj2.disabled = false;
    } else {
        dateObj1.disabled = true;
        dateObj2.disabled = true;
    }
}
//给时间输入框赋值
function timeInputValue(dateObj1, dateObj2, timeStr) {
    if (dateObj1.disabled == false) {
        dateObj1.value = timeStr.split(':')[0];
    }
    if (dateObj2.disabled == false) {
        dateObj2.value = timeStr.split(':')[1];
    }
}
//根据store给排班表赋值
function schedulingValue(store) {
    for (var i = 0; i < store.getCount(); i++) {
        var record = store.getAt(i);
        var schedulingInfoArr = record.get('schedulingInfoArr');
        var weekWorkTime = 0;
        if (schedulingInfoArr && schedulingInfoArr.length > 0) {
            for (var j = 0; j < schedulingInfoArr.length; j++) {
                var schedulingInfo = schedulingInfoArr[j];
                var idPreStr = record.get('id') + '_' + schedulingInfo.date.split('_')[1];
                var selObj = document.getElementById(idPreStr + 'sel');
                var idObj = document.getElementById(idPreStr + 'id');
                var workTimeObj = document.getElementById(idPreStr + 'workTime');

                var begmin1Obj = document.getElementById(idPreStr + '1begmin');
                var begsed1Obj = document.getElementById(idPreStr + '1begsed');
                var endmin1Obj = document.getElementById(idPreStr + '1endmin');
                var endsed1Obj = document.getElementById(idPreStr + '1endsed');

                var begmin2Obj = document.getElementById(idPreStr + '2begmin');
                var begsed2Obj = document.getElementById(idPreStr + '2begsed');
                var endmin2Obj = document.getElementById(idPreStr + '2endmin');
                var endsed2Obj = document.getElementById(idPreStr + '2endsed');

                var options = selObj.options;
                for (var n = 0; n < options.length; n++) {
                    var typeId = options[n].value.split('_')[0];
                    if (typeId === schedulingInfo.type_id) {
                        options[n].selected = "selected";
                        //初始加载时，不能靠类型中的时间来确定输入框中的值，需要根据排班表中的时间来确定

                        //判断时间输入框是否可用
                        // timeInputDisabled(begmin1Obj,begsed1Obj,options[n].value.split('_')[1]);
                        // timeInputDisabled(endmin1Obj,endsed1Obj,options[n].value.split('_')[2]);
                        // timeInputDisabled(begmin2Obj,begsed2Obj,options[n].value.split('_')[3]);
                        // timeInputDisabled(endmin2Obj,endsed2Obj,options[n].value.split('_')[4]);
                        timeInputDisabled(begmin1Obj, begsed1Obj, schedulingInfo.time_1st_begin);
                        timeInputDisabled(endmin1Obj, endsed1Obj, schedulingInfo.time_1st_end);
                        timeInputDisabled(begmin2Obj, begsed2Obj, schedulingInfo.time_2nd_begin);
                        timeInputDisabled(endmin2Obj, endsed2Obj, schedulingInfo.time_2nd_end);
                        //给时间输入框赋值
                        timeInputValue(begmin1Obj, begsed1Obj, schedulingInfo.time_1st_begin);
                        timeInputValue(endmin1Obj, endsed1Obj, schedulingInfo.time_1st_end);
                        timeInputValue(begmin2Obj, begsed2Obj, schedulingInfo.time_2nd_begin);
                        timeInputValue(endmin2Obj, endsed2Obj, schedulingInfo.time_2nd_end);
                        break;
                    }
                }
                idObj.value = schedulingInfo.id;
                workTimeObj.value = schedulingInfo.work_time;
                weekWorkTime = Number(weekWorkTime) + Number(schedulingInfo.work_time);
            }
        }
        var userId = record.get('id');
        var weekWorkTimeObj = document.getElementById(userId + 'weekWorkTime');
        var monthWorkTimeObj = document.getElementById(userId + 'workTime');
        weekWorkTimeObj.value = weekWorkTime.toFixed(1);
        monthWorkTimeObj.value = record.get('workTime').toFixed(1);
    }
}
//获取排班表格中需要提交的数据
function getSubmitData(gridStore, weekDateArr, iframeDoc) {
    var arr = [];
    var modifiedArr = [];
    var removeArr = [];
    var resStr = '';
    //修改和新增的数据
    for (var i = 0; i < gridStore.getCount(); i++) {
        var record = gridStore.getAt(i);
        var userId = record.get('id');

        for (var j = 0; j < 7; j++) {
            var idStrPre = userId + '_' + getWeekDayStr(j);
            //获取排班类型id
            var selIdStr = idStrPre + 'sel';
            var selIndex = document.getElementById(selIdStr).selectedIndex;
            var schedulingId = document.getElementById(idStrPre + 'id').value;
            //获取保存的日期
            var date = weekDateArr[j];

            if (schedulingId && schedulingId.length > 0) {
                if (selIndex == 0) {
                    var scheduling = {
                        userId: record.get('id'),
                        startDate: date,
                        endDate: date
                    }
                    removeArr.push(scheduling);
                    continue;
                }
            } else {
                if (selIndex == 0) {
                    continue;
                }
            }

            var typeId = document.getElementById(selIdStr).options[selIndex].value.split('_')[0];

            //获取第一时段开始时间字符串
            var begmin1Obj = document.getElementById(idStrPre + '1begmin');
            var begsed1Obj = document.getElementById(idStrPre + '1begsed');
            var endmin1Obj = document.getElementById(idStrPre + '1endmin');
            var endsed1Obj = document.getElementById(idStrPre + '1endsed');
            var begmin2Obj = document.getElementById(idStrPre + '2begmin');
            var begsed2Obj = document.getElementById(idStrPre + '2begsed');
            var endmin2Obj = document.getElementById(idStrPre + '2endmin');
            var endsed2Obj = document.getElementById(idStrPre + '2endsed');

            var begmin1 = begmin1Obj.value;
            var begsed1 = begsed1Obj.value;
            var endmin1 = endmin1Obj.value;
            var endsed1 = endsed1Obj.value;
            var begmin2 = begmin2Obj.value;
            var begsed2 = begsed2Obj.value;
            var endmin2 = endmin2Obj.value;
            var endsed2 = endsed2Obj.value;

            var resStrTemp = '';
            var weekChineseStr = getWeekDayChineseStr(j);
            //验证时间是否成对出现
            //能够输入值
            if (begmin1Obj.disabled === false && begsed1Obj.disabled === false) {
                var flag = dtm_startEndTimeVerify(begmin1, begsed1, endmin1, endsed1);
                resStrTemp += getVerifyStr(flag, '一');
            }
            if (begmin2Obj.disabled === false && begsed2Obj.disabled === false) {
                var flag = dtm_startEndTimeVerify(begmin2, begsed2, endmin2, endsed2);
                resStrTemp += getVerifyStr(flag, '二');
            }
            if (resStrTemp != null && resStrTemp.length > 0) {
                resStr += record.get('name') + ' ' + weekChineseStr + '的' + resStrTemp;
            }

            var time_1st_begin = begmin1 + ':' + begsed1;
            var time_1st_end = endmin1 + ':' + endsed1;
            var time_2nd_begin = begmin2 + ':' + begsed2;
            var time_2nd_end = endmin2 + ':' + endsed2;

            /* if(resStrTemp == null || resStr.length==0){
             var start1S=Number(time_1st_begin.replace(':',''));
             if(time_1st_end=='00:00'){
             time_1st_end='23:59';
             }
             var start1E=Number(time_1st_end.replace(':',''));
             if(start1S>start1E&&((start1S>1200&&start1E>1200)||(start1S<1200&&start1E<1200))){
             resStr += record.get('name') +' '+ weekChineseStr + '的第一时段排班的起始时间大于结束时间，';
             }
             var start2S=Number(time_2nd_begin.replace(':',''));
             if(time_2nd_end=='00:00'){
             time_2nd_end='23:59';
             }
             var start2E=Number(time_2nd_end.replace(':',''));
             if(start2S>start2E&&((start2S>1200&&start2E>1200)||(start2S<1200&&start2E<1200))){
             resStr += record.get('name') +' '+ weekChineseStr + '的第二时段排班的起始时间大于结束时间，';
             }
             }*/

            if (time_1st_begin == ':') {
                time_1st_begin = '';
            }
            if (time_1st_end == ':') {
                time_1st_end = '';
            }
            if (time_2nd_begin == ':') {
                time_2nd_begin = '';
            }
            if (time_2nd_end == ':') {
                time_2nd_end = '';
            }
            var amWorkTime = getHoursBetweenTwoTime(begmin1, begsed1, endmin1, endsed1);
            var pmWorkTime = getHoursBetweenTwoTime(begmin2, begsed2, endmin2, endsed2);
            var workTime = Number(amWorkTime) + Number(pmWorkTime);
            workTime = Math.round(workTime * 10) / 10;
            var scheduling = {
                id: schedulingId,
                typeId: typeId,
                userId: userId,
                date: Ext.Date.parse(date, 'Y-m-d'),
                time_1st_begin: time_1st_begin,
                time_1st_end: time_1st_end,
                time_2nd_begin: time_2nd_begin,
                time_2nd_end: time_2nd_end,
                workTime: workTime,
                owner: record.get('owner')
            }
            modifiedArr.push(scheduling);
        }
    }
    if (resStr != null && resStr.length > 0) {
        Ext.MessageBox.alert('提示', resStr + '请正确填写后再保存。');
        return null;
    }
    //被删除的数据
    var removeReds = gridStore.getRemovedRecords();
    for (var i = 0; i < removeReds.length; i++) {
        var record = removeReds[i];
        var scheduling = {
            userId: record.get('id'),
            startDate: weekDateArr[0],
            endDate: weekDateArr[6]
        }
        removeArr.push(scheduling);
    }
    arr.push(modifiedArr);
    arr.push(removeArr);
    return arr;
}
//根据是第几天获取星期字符串,第一天(n=0)就是mon
function getWeekDayStr(n) {
    if (n == 0) {
        return 'mon';
    } else if (n == 1) {
        return 'tue';
    } else if (n == 2) {
        return 'wed';
    } else if (n == 3) {
        return 'thu';
    } else if (n == 4) {
        return 'fri';
    } else if (n == 5) {
        return 'sta';
    } else if (n == 6) {
        return 'sun';
    }
}
//根据是第几天获取星期中文字符串,第一天(n=0)就是星期一
function getWeekDayChineseStr(n) {
    if (n == 0) {
        return '星期一';
    } else if (n == 1) {
        return '星期二';
    } else if (n == 2) {
        return '星期三';
    } else if (n == 3) {
        return '星期四';
    } else if (n == 4) {
        return '星期五';
    } else if (n == 5) {
        return '星期六';
    } else if (n == 6) {
        return '星期日';
    }
}
//根据星期英文标示字符串获取是第几天,第一天mon就是(n=0)
function getWeekDayNumberStr(n) {
    if (n == 'mon') {
        return 0;
    } else if (n == 'tue') {
        return 1;
    } else if (n == 'wed') {
        return 2;
    } else if (n == 'thu') {
        return 3;
    } else if (n == 'fri') {
        return 4;
    } else if (n == 'sta') {
        return 5;
    } else if (n == 'sun') {
        return 6;
    }
}
//获取两个时间的小时分钟差
function getHoursBetweenTwoTime(hour1, min1, hour2, min2) {
    if (hour1 != '' && min1 != '' && hour2 != '' && min2 != '') {
        var hour = 0;
        if (parseInt(min1) > 0) {
            hour1 = parseInt(hour1) + 1;
            min1 = 60 - parseInt(min1);
        }
        if (parseInt(hour1) < parseInt(hour2)) {
            hour = parseInt(hour2) - parseInt(hour1);
        } else if (parseInt(hour1) > parseInt(hour2)) {
            hour = 24 + (parseInt(hour2) - parseInt(hour1));
        }
        var min = parseInt(min1) + parseInt(min2);
        if (min >= 60) {
            hour = hour + parseInt(min / 60);
            min = ((min % 60) / 60).toFixed(2);
        } else {
            min = (min / 60).toFixed(2);
        }
        return Number(hour) + Number(min);
    } else {
        return 0;
    }
}
//根据上周arr给排班表赋值
function preSchedulingValue(gridStore, data, currentDateArr, date) {
    for (var i = 0; i < gridStore.getCount(); i++) {
        var schedulingInfoRed = gridStore.getAt(i);
        var currUserId = schedulingInfoRed.get('id');
        //所有记录的sel、时间框置空
        for (var m = 0; m < 7; m++) {
            var idPreStr = currUserId + '_' + getWeekDayStr(m);
            var selObj = document.getElementById(idPreStr + 'sel');
            var workTimeObj = document.getElementById(idPreStr + 'workTime');

            var begmin1Obj = document.getElementById(idPreStr + '1begmin');
            var begsed1Obj = document.getElementById(idPreStr + '1begsed');
            var endmin1Obj = document.getElementById(idPreStr + '1endmin');
            var endsed1Obj = document.getElementById(idPreStr + '1endsed');

            var begmin2Obj = document.getElementById(idPreStr + '2begmin');
            var begsed2Obj = document.getElementById(idPreStr + '2begsed');
            var endmin2Obj = document.getElementById(idPreStr + '2endmin');
            var endsed2Obj = document.getElementById(idPreStr + '2endsed');

            selObj.options[0].selected = "selected";
            workTimeObj.value = '';
            begmin1Obj.value = '';
            begsed1Obj.value = '';
            endmin1Obj.value = '';
            endsed1Obj.value = '';

            begmin2Obj.value = '';
            begsed2Obj.value = '';
            endmin2Obj.value = '';
            endsed2Obj.value = '';

            begmin1Obj.disabled = true;
            begsed1Obj.disabled = true;
            endmin1Obj.disabled = true;
            endsed1Obj.disabled = true;

            begmin2Obj.disabled = true;
            begsed2Obj.disabled = true;
            endmin2Obj.disabled = true;
            endsed2Obj.disabled = true;
        }
        var weekWorkTime = 0;
        //多余时间
        var extraWorkTime = 0;
        //将当前页面的时间累计相加，复制上周时间后，要减去当前页面的和
        var totalMonth = date.getMonth(), schMonth;
        for (var k = 0; k < schedulingInfoRed.get('schedulingInfoArr').length; k++) {
            schMonth = new Date(schedulingInfoRed.get('schedulingInfoArr')[k].date.split('_')[0]).getMonth();
            if (schMonth == totalMonth) {
                extraWorkTime += Number(schedulingInfoRed.get('schedulingInfoArr')[k].work_time);
            }
        }

        var monthWorkTime = Number(schedulingInfoRed.get('workTime')) - extraWorkTime;
        monthWorkTime = monthWorkTime < 0 ? 0 : monthWorkTime
        for (var j = 0; j < data.length; j++) {
            var scheduling = data[j];
            var preUserId = scheduling.id;
            var schedulingInfoArr = scheduling.schedulingInfoArr;
            if (currUserId === preUserId && schedulingInfoArr && schedulingInfoArr.length > 0) {
                for (var m = 0; m < schedulingInfoArr.length; m++) {
                    var schedulingInfo = schedulingInfoArr[m];
                    var idPreStr = currUserId + '_' + schedulingInfo.date.split('_')[1];
                    var selObj = document.getElementById(idPreStr + 'sel');
                    var workTimeObj = document.getElementById(idPreStr + 'workTime');

                    var begmin1Obj = document.getElementById(idPreStr + '1begmin');
                    var begsed1Obj = document.getElementById(idPreStr + '1begsed');
                    var endmin1Obj = document.getElementById(idPreStr + '1endmin');
                    var endsed1Obj = document.getElementById(idPreStr + '1endsed');

                    var begmin2Obj = document.getElementById(idPreStr + '2begmin');
                    var begsed2Obj = document.getElementById(idPreStr + '2begsed');
                    var endmin2Obj = document.getElementById(idPreStr + '2endmin');
                    var endsed2Obj = document.getElementById(idPreStr + '2endsed');

                    var options = selObj.options;
                    for (var n = 0; n < options.length; n++) {
                        var typeId = options[n].value.split('_')[0];
                        if (typeId === schedulingInfo.type_id) {
                            options[n].selected = "selected";

                            //判断时间输入框是否可用
                            timeInputDisabled(begmin1Obj, begsed1Obj, schedulingInfo.time_1st_begin);
                            timeInputDisabled(endmin1Obj, endsed1Obj, schedulingInfo.time_1st_end);
                            timeInputDisabled(begmin2Obj, begsed2Obj, schedulingInfo.time_2nd_begin);
                            timeInputDisabled(endmin2Obj, endsed2Obj, schedulingInfo.time_2nd_end);
                            //给时间输入框赋值
                            timeInputValue(begmin1Obj, begsed1Obj, schedulingInfo.time_1st_begin);
                            timeInputValue(endmin1Obj, endsed1Obj, schedulingInfo.time_1st_end);
                            timeInputValue(begmin2Obj, begsed2Obj, schedulingInfo.time_2nd_begin);
                            timeInputValue(endmin2Obj, endsed2Obj, schedulingInfo.time_2nd_end);
                            break;
                        }
                    }
                    workTimeObj.value = schedulingInfo.work_time;
                    weekWorkTime = Number(weekWorkTime) + Number(schedulingInfo.work_time);
                    //本月工时计算 判断当前日期是否跟周一是一个月的日期，如果是，累加，如果不是，不累加
                    var currentWeekDay = schedulingInfo.date.split('_')[1];
                    var currentDate = currentDateArr[getWeekDayNumberStr(currentWeekDay)];
                    if (currentDateArr[0].substring(0, 7) === currentDate.substring(0, 7)) {
                        monthWorkTime = Number(monthWorkTime) + Number(schedulingInfo.work_time);
                    }
                }
            }
        }
        var userId = currUserId;
        var weekWorkTimeObj = document.getElementById(userId + 'weekWorkTime');
        var monthWorkTimeObj = document.getElementById(userId + 'workTime');
        weekWorkTimeObj.value = weekWorkTime.toFixed(2);
        //本月工时计算 判断当前日期是否跟周一是一个月的日期，如果是，累加，如果不是，不累加
        //monthWorkTimeObj.value = scheduling.workTime;
        monthWorkTimeObj.value = monthWorkTime.toFixed(2);
    }
}
//验证起始、结束时间字符串是否成对出现
function dtm_startEndTimeVerify(begHour, begMin, endHour, endMin) {
    //小时和分钟是否有为空情况
    //小时、分钟都为空
    if (begHour != null && begHour === '' && begMin != null && begMin === '') {

    }
    if (endHour != null && endHour === '' && endMin != null && endMin === '') {

    }
    //小时、分钟都不为空
    if (begHour != null && begHour.length > 0 && begMin != null && begMin.length > 0) {

    }
    if (endHour != null && endHour.length > 0 && endMin != null && endMin.length > 0) {

    }
    //小时为空,分钟不为空
    if (begHour != null && begHour === '' && begMin != null && begMin.length > 0) {
        return 11;
    }
    if (endHour != null && endHour === '' && endMin != null && endMin.length > 0) {
        return 21;
    }
    //小时不为空,分钟为空
    if (begHour != null && begHour.length > 0 && begMin != null && begMin === '') {
        return 12;
    }
    if (endHour != null && endHour.length > 0 && endMin != null && endMin === '') {
        return 22;
    }

    var startStr = begHour + ':' + begMin;
    var endStr = endHour + ':' + endMin;
    //起始、结束时间为空
    if (startStr != null && startStr === '' && endStr != null && endStr === '') {
        return 0;
    }
    //起始、结束时间不为空
    if (startStr != null && startStr.length > 0 && endStr != null && endStr.length > 0) {
        return 0;
    }
    //起始时间不为空、结束时间为空
    if (startStr != null && startStr.length > 0 && endStr != null && endStr === '') {
        return 1;
    }
    //起始时间为空、结束时间不为空
    if (startStr != null && startStr === '' && endStr != null && endStr.length > 0) {
        return 2;
    }
}
//根据验证返回值返回提示字符串
function getVerifyStr(flag, period) {
    var resStr = '';
    if (parseInt(flag) > 0) {
        if (parseInt(flag) === 11) {
            resStr += '第' + period + '时段排班的开始时间中的小时为空;';
        }
        if (parseInt(flag) === 21) {
            resStr += '第' + period + '时段排班的结束时间中的小时为空;';
        }
        if (parseInt(flag) === 12) {
            resStr += '第' + period + '时段排班的开始时间中的分钟为空;';
        }
        if (parseInt(flag) === 22) {
            resStr += '第' + period + '时段排班的结束时间中的分钟为空;';
        }
        if (parseInt(flag) === 1) {
            resStr += '第' + period + '时段排班的结束时间为空;';
        }
        if (parseInt(flag) === 2) {
            resStr += '第' + period + '时段排班的开始时间为空;';
        }
    }
    return resStr;
}
</script>
</head>
<body oncontextmenu=self.event.returnValue=false>
</body>
</html>